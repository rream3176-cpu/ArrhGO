<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1a2a3a;
      color: #fff;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      color: #37D6C0;
    }
    .restaurant-card {
      background: linear-gradient(135deg, rgba(22, 58, 95, 0.9), rgba(14, 31, 51, 0.95));
      border: 2px solid rgba(55, 214, 192, 0.4);
      border-radius: 10px;
      padding: 20px;
      margin: 15px 0;
    }
    .restaurant-card h3 {
      color: #37D6C0;
      margin-top: 0;
    }
    .info {
      background: #17a2b8;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
    }
    .error {
      background: #dc3545;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
    }
    .success {
      background: #28a745;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
    }
    button {
      background: #37D6C0;
      color: #1a2a3a;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #4DFFD1;
    }
    pre {
      background: #2a3a4a;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø·Ø§Ø¹Ù… - Ù…Ø¨Ø§Ø´Ø±</h1>
    
    <div class="info">
      <h3>ØªØ¹Ù„ÙŠÙ…Ø§Øª:</h3>
      <p>1. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…" Ù„Ø±Ø¤ÙŠØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</p>
      <p>2. Ø§ÙØªØ­ Console (F12) Ù„Ø±Ø¤ÙŠØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„</p>
    </div>
    
    <button onclick="loadRestaurants()">Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</button>
    <button onclick="loadRestaurantsWithFilter('Ø¹Ø±Ø¨ÙŠ')">Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
    <button onclick="clearResults()">Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
    
    <div id="status"></div>
    <div id="results"></div>
  </div>

  <script>
    function getBaseUrl() {
      return window.location.protocol === 'file:' 
        ? 'http://localhost/ArhGo-trip-planner/' 
        : './';
    }

    async function loadRestaurants(foodType = '') {
      const statusDiv = document.getElementById('status');
      const resultsDiv = document.getElementById('results');
      
      statusDiv.innerHTML = '<div class="info">â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…...</div>';
      resultsDiv.innerHTML = '';

      try {
        const baseUrl = getBaseUrl();
        let url = baseUrl + 'api/get_restaurants.php';
        if (foodType) {
          url += '?food_type=' + encodeURIComponent(foodType);
        }
        
        console.log('ğŸ” URL:', url);
        console.log('ğŸŒ Base URL:', baseUrl);
        console.log('ğŸŒ Protocol:', window.location.protocol);

        const response = await fetch(url);
        console.log('ğŸ“¥ Response status:', response.status);
        console.log('ğŸ“¥ Response headers:', response.headers);

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        console.log('ğŸ“¦ Result:', result);
        console.log('ğŸ“Š Success:', result.success);
        console.log('ğŸ“Š Count:', result.count);
        console.log('ğŸ“Š Total in DB:', result.total_in_db);
        console.log('ğŸ“Š Data length:', result.data ? result.data.length : 0);

        if (result.success && result.data && result.data.length > 0) {
          statusDiv.innerHTML = `<div class="success">âœ… ØªÙ… Ø¬Ù„Ø¨ ${result.data.length} Ù…Ø·Ø¹Ù… (Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${result.total_in_db || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'})</div>`;
          
          resultsDiv.innerHTML = result.data.map((rest, index) => {
            return `
              <div class="restaurant-card">
                <h3>${index + 1}. ${rest.name || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</h3>
                <p><strong>Ø§Ù„ÙˆØµÙ:</strong> ${rest.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                <p><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</strong> ${rest.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                <p><strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${rest.city_name_ar || rest.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                <p><strong>Ø§Ù„Ø¯ÙˆÙ„Ø©:</strong> ${rest.country_name_ar || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø·Ø¹Ø§Ù…:</strong> ${rest.food_type || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                <p><strong>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong> ${rest.rating || 0} â­</p>
                <p><strong>Ø§Ù„Ø³Ø¹Ø±:</strong> ${rest.price_range || '$'}</p>
                <p><strong>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„:</strong> ${rest.open_hour || 10}:00 - ${rest.close_hour || 22}:00</p>
                <p><strong>ID:</strong> ${rest.id}</p>
              </div>
            `;
          }).join('');
        } else {
          statusDiv.innerHTML = `<div class="error">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø·Ø§Ø¹Ù… ÙÙŠ Ø§Ù„Ù†ØªÙŠØ¬Ø©. Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${result.total_in_db || 0}</div>`;
          resultsDiv.innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
        }
      } catch (error) {
        console.error('âŒ Error:', error);
        statusDiv.innerHTML = `<div class="error">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
        resultsDiv.innerHTML = '<pre>' + error.stack + '</pre>';
      }
    }

    function loadRestaurantsWithFilter(foodType) {
      loadRestaurants(foodType);
    }

    function clearResults() {
      document.getElementById('status').innerHTML = '';
      document.getElementById('results').innerHTML = '';
    }

    // ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸ“„ Ø§Ù„ØµÙØ­Ø© Ø¬Ø§Ù‡Ø²Ø©');
      loadRestaurants();
    });
  </script>
</body>
</html>

