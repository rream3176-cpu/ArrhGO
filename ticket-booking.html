<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ArhGo | Ø­Ø¬Ø² Ø§Ù„Ø±Ø­Ù„Ø§Øª</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/arhgo.css">
  <script src="assets/js/arhgo.js" defer></script>
  <script src="assets/js/booking-system.js" defer></script>
  <style>
    body {
      background: var(--bg-primary);
      padding-top: 80px;
    }
    
    .wrapper {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: var(--spacing-xl);
      margin-top: var(--spacing-lg);
      max-width: 1400px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .booking-form,
    .summary-card {
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      background: linear-gradient(135deg, rgba(20, 27, 45, 0.8) 0%, rgba(15, 22, 36, 0.9) 100%);
      backdrop-filter: blur(30px) saturate(200%);
      -webkit-backdrop-filter: blur(30px) saturate(200%);
      border: 1px solid rgba(0, 229, 255, 0.2);
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.4),
        0 0 0 1px rgba(0, 229, 255, 0.1),
        inset 0 1px 1px rgba(255, 255, 255, 0.1);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .booking-form::before,
    .summary-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(0, 229, 255, 0.6) 20%, 
        rgba(0, 207, 200, 0.6) 50%, 
        rgba(0, 229, 255, 0.6) 80%, 
        transparent 100%);
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    
    .booking-form:hover::before,
    .summary-card:hover::before {
      opacity: 1;
    }
    
    .booking-form:hover,
    .summary-card:hover {
      transform: translateY(-4px);
      box-shadow: 
        0 30px 80px rgba(0, 0, 0, 0.5),
        0 0 60px rgba(0, 229, 255, 0.3),
        inset 0 1px 1px rgba(255, 255, 255, 0.15);
      border-color: rgba(0, 229, 255, 0.5);
    }
    
    @media (max-width: 1024px) {
      .wrapper {
        grid-template-columns: 1fr;
      }
      .summary-card {
        position: relative !important;
        top: 0 !important;
        max-height: none !important;
      }
    }
    
    .booking-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-sm);
    }
    
    .booking-form .field {
      margin-bottom: 0;
    }
    
    .booking-form .field label {
      font-size: 0.85rem;
      margin-bottom: 6px;
      text-transform: uppercase;
      opacity: 0.8;
    }
    
    .booking-form .arhgo-input,
    .booking-form .arhgo-select,
    .booking-form .arhgo-textarea {
      width: 100%;
      padding: 10px 14px;
      font-size: 0.9rem;
      color: var(--text-primary) !important;
      background: linear-gradient(135deg, rgba(11, 15, 26, 0.8) 0%, rgba(15, 22, 36, 0.9) 100%) !important;
    }
    
    .booking-form .arhgo-select:focus,
    .booking-form .arhgo-input:focus {
      background: linear-gradient(135deg, rgba(30, 40, 60, 0.95) 0%, rgba(35, 45, 70, 1) 100%) !important;
      border-color: rgba(0, 229, 255, 0.4) !important;
    }
    
    .booking-form .arhgo-select option {
      background: rgba(30, 40, 60, 0.95) !important;
      color: var(--text-primary) !important;
      padding: 12px;
    }
    
    .booking-form .arhgo-select option:checked,
    .booking-form .arhgo-select option:hover {
      background: rgba(0, 229, 255, 0.3) !important;
      color: var(--neon-cyan) !important;
    }
    
    /* Ø­Ù‚ÙˆÙ„ full-width */
    .booking-form .field.full-width {
      grid-column: 1 / -1;
    }
    
    /* Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ */
    .booking-form .btn {
      grid-column: 1 / -1;
      margin-top: var(--spacing-sm);
      padding: 14px 24px;
      font-weight: 600;
    }
    
    .summary-card {
      position: sticky;
      top: 100px;
      height: fit-content;
      max-height: calc(100vh - 120px);
      overflow-y: auto;
    }
    
    .summary-card h3 {
      margin: 0 0 var(--spacing-md) 0;
      color: var(--neon-cyan);
      font-size: 1.5rem;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .summary-card .summary-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid rgba(0, 229, 255, 0.1);
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    
    .summary-item:last-child {
      border-bottom: none;
      font-weight: 700;
      font-size: 1.2rem;
      color: var(--neon-cyan);
      margin-top: var(--spacing-sm);
      padding-top: var(--spacing-sm);
      border-top: 1px solid rgba(0, 229, 255, 0.2);
    }
    
    .success-message {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      margin-top: var(--spacing-md);
      text-align: center;
      color: var(--text-primary);
    }
    
    .booking-id {
      font-family: 'Courier New', monospace;
      background: rgba(0, 229, 255, 0.1);
      padding: 8px 12px;
      border-radius: var(--radius-sm);
      margin-top: 10px;
      display: inline-block;
      color: var(--neon-cyan);
      border: 1px solid rgba(0, 229, 255, 0.25);
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
  </style>
</head>
<body class="page-hidden">
  <nav class="arhgo-nav">
    <div class="arhgo-logo">ArhGo</div>
    <ul>
      <li><a data-nav href="index.html#home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
      <li><a data-nav href="index.html#features">Ø§Ù„Ù…Ø²Ø§ÙŠØ§</a></li>
      <li><a data-nav href="index.html#planner">Ø®Ø·Ø· Ø±Ø­Ù„ØªÙƒ</a></li>
      <li><a data-nav href="index.html#destinations">Ø§Ù„ÙˆØ¬Ù‡Ø§Øª</a></li>
      <li><a data-nav href="hotel.html">Ø§Ù„ÙÙ†Ø§Ø¯Ù‚</a></li>
      <li><a data-nav href="ticket-booking.html">Ø­Ø¬Ø² Ø§Ù„Ø±Ø­Ù„Ø§Øª</a></li>
      <li><a data-nav href="Restuarnt.html">Ø­Ø¬Ø² Ø§Ù„Ù…Ø·Ø§Ø¹Ù…</a></li>
      <li><a data-nav href="my-bookings.html">Ø­Ø¬ÙˆØ²Ø§ØªÙŠ</a></li>
    </ul>
    <div class="stack">
      <a class="btn btn-ghost" href="login.html" data-flight-sound id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
      <a class="btn btn-gradient" href="signup.html" data-flight-sound id="signupBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
    </div>
  </nav>
  <main class="page-shell">
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">Ø­Ø¬Ø² Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø¬ÙˆÙŠØ©</h2>
        <p class="section-subtitle">Ø§Ø­Ø¬Ø² Ø±Ø­Ù„ØªÙƒ Ø¨Ø³Ù‡ÙˆÙ„Ø© ÙˆØ£Ù…Ø§Ù†. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ØªÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆÙŠÙ…ÙƒÙ†Ùƒ Ø·Ø¨Ø§Ø¹ØªÙ‡Ø§.</p>
      </div>
      <div class="wrapper">
        <form id="bookingForm" class="booking-form">
          <div class="field">
            <label>Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø© *</label>
            <select class="arhgo-select" id="tripType" required>
              <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©</option>
              <option value="Ø°Ù‡Ø§Ø¨ ÙÙ‚Ø·">Ø°Ù‡Ø§Ø¨ ÙÙ‚Ø·</option>
              <option value="Ø°Ù‡Ø§Ø¨ ÙˆØ¹ÙˆØ¯Ø©">Ø°Ù‡Ø§Ø¨ ÙˆØ¹ÙˆØ¯Ø©</option>
              <option value="Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ù‡Ø§Øª">Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ù‡Ø§Øª</option>
            </select>
          </div>
          <div class="field">
            <label>Ù…Ù† *</label>
            <input class="arhgo-input" type="text" id="from" placeholder="Ù…Ø«Ø§Ù„: Ø¨ØºØ¯Ø§Ø¯" required>
          </div>
          <div class="field">
            <label>Ø¥Ù„Ù‰ *</label>
            <input class="arhgo-input" type="text" id="to" placeholder="Ù…Ø«Ø§Ù„: Ø¯Ø¨ÙŠ" required>
          </div>
          <div class="field">
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø© *</label>
            <input class="arhgo-input" type="date" id="depart" required>
          </div>
          <div class="field" id="returnField" style="display: none;">
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹ÙˆØ¯Ø©</label>
            <input class="arhgo-input" type="date" id="return">
          </div>
          <div class="field">
            <label>Ø§Ù„Ø¯Ø±Ø¬Ø© *</label>
            <select class="arhgo-select" id="classType" required>
              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¯Ø±Ø¬Ø©</option>
              <option value="Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©">Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©</option>
              <option value="Ø¯Ø±Ø¬Ø© Ø±Ø¬Ø§Ù„ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„">Ø¯Ø±Ø¬Ø© Ø±Ø¬Ø§Ù„ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</option>
              <option value="Ø§Ù„Ø£ÙˆÙ„Ù‰">Ø§Ù„Ø£ÙˆÙ„Ù‰</option>
            </select>
          </div>
          <div class="field">
            <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³Ø§ÙØ±ÙŠÙ† *</label>
            <div class="stack" style="gap:8px;">
              <button type="button" class="btn btn-ghost" onclick="changeCount(-1)" style="min-width: 40px; padding: 10px;">âˆ’</button>
              <input class="arhgo-input" type="number" id="pcount" value="1" min="1" max="9" required style="text-align:center;">
              <button type="button" class="btn btn-ghost" onclick="changeCount(1)" style="min-width: 40px; padding: 10px;">+</button>
            </div>
          </div>
          <div class="field full-width">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
              <input type="checkbox" id="nonstop" style="width: auto;">
              <span style="text-transform: none; opacity: 1;">Ø£ÙØ¶Ù„ Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø¨Ø¯ÙˆÙ† ØªÙˆÙ‚Ù</span>
            </label>
          </div>
          <div class="field">
            <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
            <input class="arhgo-input" type="text" id="fullname" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" required>
          </div>
          <div class="field">
            <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
            <input class="arhgo-input" type="email" id="email" placeholder="example@mail.com" required>
          </div>
          <div class="field">
            <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
            <input class="arhgo-input" type="tel" id="phone" placeholder="+964 770 000 0000" required>
          </div>
          <div class="field">
            <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ *</label>
            <select class="arhgo-select" id="payment" required>
              <option value="">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</option>
              <option value="Ù†Ù‚Ø¯Ù‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„">Ù†Ù‚Ø¯Ù‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„</option>
              <option value="Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†">Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†</option>
              <option value="Ø¯ÙØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">Ø¯ÙØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</option>
            </select>
          </div>
          <div class="field full-width">
            <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
            <textarea class="arhgo-textarea" id="notes" placeholder="Ø·Ù„Ø¨Ø§Øª Ø®Ø§ØµØ© Ø£Ùˆ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©" style="min-height: 80px;"></textarea>
          </div>
          <button class="btn btn-gradient" type="submit">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²</button>
        </form>

        <article class="summary-card">
          <h3>Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø¬Ø²</h3>
          <div id="summaryContent">
            <div class="summary-item"><span>Ø§Ù„Ø±Ø­Ù„Ø©</span><span id="sumTrip">â€”</span></div>
            <div class="summary-item"><span>Ù…Ù† â€” Ø¥Ù„Ù‰</span><span id="sumRoute">â€”</span></div>
            <div class="summary-item"><span>Ø§Ù„ØªØ§Ø±ÙŠØ®</span><span id="sumDate">â€”</span></div>
            <div class="summary-item"><span>Ø§Ù„Ù…Ø³Ø§ÙØ±ÙˆÙ†</span><span id="sumPassengers">1</span></div>
            <div class="summary-item"><span>Ø§Ù„Ø¯Ø±Ø¬Ø©</span><span id="sumClass">â€”</span></div>
            <div class="summary-item"><span>Ø¨Ø¯ÙˆÙ† ØªÙˆÙ‚Ù</span><span id="sumNonstop">Ù„Ø§</span></div>
            <div class="summary-item"><span>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><span id="sumPrice">$0</span></div>
          </div>
          <div id="successMessage" class="success-message" style="display: none;">
            <h4 style="color: var(--success); margin: 0 0 10px 0;">âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­!</h4>
            <p>Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²:</p>
            <div class="booking-id" id="bookingIdDisplay"></div>
            <div class="action-buttons">
              <button class="btn btn-gradient" onclick="printBooking()" style="flex: 1;">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªØ°ÙƒØ±Ø©</button>
              <button class="btn btn-ghost" onclick="resetForm()" style="flex: 1;">Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯</button>
            </div>
          </div>
        </article>
      </div>
    </section>
  </main>

  <script>
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    function updateAuthButtons() {
      console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø±...');
      const session_token = localStorage.getItem('session_token');
      const userStr = localStorage.getItem('user');
      const user = userStr ? JSON.parse(userStr) : {};
      const loginBtn = document.getElementById('loginBtn');
      const signupBtn = document.getElementById('signupBtn');
      
      console.log('Session token:', session_token ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
      console.log('User data:', user);
      console.log('Login button:', loginBtn ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
      console.log('Signup button:', signupBtn ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
      
      if (!loginBtn || !signupBtn) {
        console.warn('âš ï¸ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø¹Ø¯');
        setTimeout(updateAuthButtons, 500);
        return;
      }
      
      if (session_token && user.full_name) {
        // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
        loginBtn.textContent = user.full_name;
        loginBtn.href = 'my-bookings.html';
        loginBtn.style.color = '#37D6C0';
        signupBtn.textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬';
        signupBtn.href = '#';
        signupBtn.onclick = (e) => {
          e.preventDefault();
          if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
            localStorage.removeItem('session_token');
            localStorage.removeItem('user');
            localStorage.removeItem('arhgo_current_user');
            localStorage.removeItem('loggedIn');
            window.location.href = 'login.html';
          }
        };
        console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± - Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„:', user.full_name);
      } else {
        // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
        loginBtn.textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
        loginBtn.href = 'login.html';
        loginBtn.style.color = '';
        signupBtn.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨';
        signupBtn.href = 'signup.html';
        signupBtn.onclick = null;
        console.log('â„¹ï¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„');
      }
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', updateAuthButtons);
    } else {
      updateAuthButtons();
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
    window.addEventListener('authStateChanged', updateAuthButtons);
    window.addEventListener('storage', updateAuthButtons);
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø©
    window.addEventListener('focus', updateAuthButtons);
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) {
        updateAuthButtons();
      }
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† (Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«)
    document.addEventListener('click', () => {
      setTimeout(updateAuthButtons, 100);
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙƒÙ„ 2 Ø«Ø§Ù†ÙŠØ© Ù„Ù„ØªØ£ÙƒØ¯
    setInterval(updateAuthButtons, 2000);
    
    let currentBooking = null;

    // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„ØªØ§Ø±ÙŠØ® (Ø§Ù„ÙŠÙˆÙ…)
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('depart').setAttribute('min', today);
    document.getElementById('return').setAttribute('min', today);

    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚Ù„ Ø§Ù„Ø¹ÙˆØ¯Ø©
    document.getElementById('tripType').addEventListener('change', function() {
      const returnField = document.getElementById('returnField');
      if (this.value === 'Ø°Ù‡Ø§Ø¨ ÙˆØ¹ÙˆØ¯Ø©') {
        returnField.style.display = 'block';
        document.getElementById('return').setAttribute('required', 'required');
      } else {
        returnField.style.display = 'none';
        document.getElementById('return').removeAttribute('required');
      }
      updateSummary();
    });

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ù‚ÙˆÙ„
    ['tripType', 'from', 'to', 'depart', 'return', 'classType', 'pcount', 'nonstop'].forEach(id => {
      const element = document.getElementById(id);
      if (element) {
        element.addEventListener('change', updateSummary);
        element.addEventListener('input', updateSummary);
      }
    });

    function updateSummary() {
      const tripType = document.getElementById('tripType').value || 'â€”';
      const from = document.getElementById('from').value || 'â€”';
      const to = document.getElementById('to').value || 'â€”';
      const depart = document.getElementById('depart').value || 'â€”';
      const returnDate = document.getElementById('return').value || '';
      const classType = document.getElementById('classType').value || 'â€”';
      const pcount = parseInt(document.getElementById('pcount').value) || 1;
      const nonstop = document.getElementById('nonstop').checked ? 'Ù†Ø¹Ù…' : 'Ù„Ø§';

      document.getElementById('sumTrip').textContent = tripType;
      document.getElementById('sumRoute').textContent = `${from} â€” ${to}`;
      document.getElementById('sumDate').textContent = returnDate ? `${depart} / ${returnDate}` : depart;
      document.getElementById('sumPassengers').textContent = pcount;
      document.getElementById('sumClass').textContent = classType;
      document.getElementById('sumNonstop').textContent = nonstop;

      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø±
      if (tripType !== 'â€”' && from !== 'â€”' && to !== 'â€”' && classType !== 'â€”') {
        const price = bookingSystem.calculateFlightPrice(tripType, classType, pcount, from, to);
        document.getElementById('sumPrice').textContent = `$${price}`;
      } else {
        document.getElementById('sumPrice').textContent = '$0';
      }
    }

    function changeCount(delta) {
      const el = document.getElementById('pcount');
      let val = parseInt(el.value, 10) || 1;
      val = Math.min(9, Math.max(1, val + delta));
      el.value = val;
      updateSummary();
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    document.getElementById('bookingForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const session_token = localStorage.getItem('session_token');
      if (!session_token) {
        alert('âŒ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø­Ø¬Ø² Ø±Ø­Ù„Ø©');
        window.location.href = 'login.html';
        return;
      }

      const formData = {
        trip: document.getElementById('tripType').value,
        from: document.getElementById('from').value,
        to: document.getElementById('to').value,
        depart: document.getElementById('depart').value,
        return: document.getElementById('return').value || null,
        pcount: parseInt(document.getElementById('pcount').value),
        classType: document.getElementById('classType').value,
        nonstop: document.getElementById('nonstop').checked,
        fullname: document.getElementById('fullname').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        payment: document.getElementById('payment').value,
        notes: document.getElementById('notes').value
      };

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
      if (!formData.from || !formData.to || !formData.depart || !formData.classType) {
        alert('âŒ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
        return;
      }

      // ØªØ­ÙˆÙŠÙ„ classType Ø¥Ù„Ù‰ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ù† API
      let class_type = formData.classType;
      if (class_type === 'Ø¯Ø±Ø¬Ø© Ø±Ø¬Ø§Ù„ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„') {
        class_type = 'Ø±Ø¬Ø§Ù„ Ø£Ø¹Ù…Ø§Ù„';
      } else if (class_type === 'Ø§Ù„Ø£ÙˆÙ„Ù‰') {
        class_type = 'Ø£ÙˆÙ„Ù‰';
      } else if (class_type === 'Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©') {
        class_type = 'Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©';
      }

      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ API
      const bookingPayload = {
        session_token: session_token,
        from_city: formData.from,
        to_city: formData.to,
        departure_date: formData.depart,
        return_date: formData.return,
        passengers: formData.pcount,
        class_type: class_type,
        special_requests: formData.notes || ''
      };

      // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø¬Ø²...';

      try {
        const baseUrl = window.location.protocol === 'file:' ? 'http://localhost/ArhGo-trip-planner/' : './';
        
        console.log('ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¬Ø² Ø§Ù„Ø±Ø­Ù„Ø©:', bookingPayload);
        console.log('ğŸŒ URL:', baseUrl + 'api/book_flight.php');
        
        const response = await fetch(baseUrl + 'api/book_flight.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(bookingPayload)
        });

        console.log('ğŸ“¥ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:', response.status, response.statusText);
        
        const result = await response.json();
        console.log('ğŸ“¦ Ø§Ù„Ù†ØªÙŠØ¬Ø©:', result);

        if (result.success) {
          console.log('âœ… ØªÙ… Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­! Ø±Ù‚Ù… Ø§Ù„Ø­Ø¬Ø²:', result.booking_reference);
          
          // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø£ÙŠØ¶Ø§Ù‹ Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
          currentBooking = {
            id: result.booking_reference,
            type: 'flight',
            ...formData,
            price: result.total_price,
            createdAt: new Date().toISOString(),
            status: 'confirmed'
          };
          bookingSystem.bookFlight(currentBooking);
          
          // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
          document.getElementById('bookingIdDisplay').textContent = result.booking_reference;
          document.getElementById('successMessage').style.display = 'block';
          document.getElementById('summaryContent').style.opacity = '0.6';

          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„Ù…Ù„Ø®Øµ
          document.getElementById('sumPrice').textContent = `$${result.total_price}`;

          // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
          setTimeout(() => {
            document.getElementById('bookingForm').reset();
            updateSummary();
            submitBtn.disabled = false;
            submitBtn.textContent = originalText;
          }, 3000);
        } else {
          console.error('âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø¬Ø²:', result);
          throw new Error(result.error || 'ÙØ´Ù„ Ø§Ù„Ø­Ø¬Ø²');
        }

      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø¬Ø² Ø§Ù„Ø±Ø­Ù„Ø©:', error);
        console.error('ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:', {
          message: error.message,
          stack: error.stack,
          name: error.name
        });
        
        let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø²';
        if (error.message) {
          errorMessage = error.message;
        } else if (error instanceof TypeError && error.message.includes('fetch')) {
          errorMessage = 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ùƒ ØªØ³ØªØ®Ø¯Ù… http://localhost';
        }
        
        alert('âŒ ' + errorMessage + '\n\nØ§ÙØªØ­ Console (F12) Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„');
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    });

    function printBooking() {
      if (currentBooking) {
        bookingSystem.printBooking(currentBooking);
      }
    }

    function resetForm() {
      document.getElementById('bookingForm').reset();
      document.getElementById('successMessage').style.display = 'none';
      document.getElementById('summaryContent').style.opacity = '1';
      currentBooking = null;
      updateSummary();
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    updateSummary();
  </script>
</body>
</html>
