<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ArhGo | ูููุฏ ุฎุทุท ุฐูู</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/arhgo.css">
  <script src="assets/js/arhgo.js" defer></script>
  <script src="assets/js/countries-database.js"></script>
  <script src="assets/js/plan-manager.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body {
      background: var(--bg-primary);
      padding-top: 80px;
      font-family: 'Cairo', sans-serif !important;
    }
    
    .planner-container {
      max-width: 900px;
      margin: 0 auto;
      padding: var(--spacing-md) var(--spacing-lg);
    }
    
    .page-header {
      text-align: center;
      margin-bottom: var(--spacing-md);
    }
    
    .page-header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
      font-family: 'Cairo', sans-serif;
    }
    
    .page-header p {
      font-size: 0.9rem;
      color: var(--text-secondary);
      font-family: 'Cairo', sans-serif;
    }
    
    .plan-card {
      border-radius: var(--radius-md);
      padding: var(--spacing-md);
      background: linear-gradient(135deg, rgba(20, 27, 45, 0.8) 0%, rgba(15, 22, 36, 0.9) 100%);
      backdrop-filter: blur(30px) saturate(200%);
      -webkit-backdrop-filter: blur(30px) saturate(200%);
      border: 1px solid rgba(0, 229, 255, 0.2);
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.4),
        0 0 0 1px rgba(0, 229, 255, 0.1),
        inset 0 1px 1px rgba(255, 255, 255, 0.1);
      margin-bottom: var(--spacing-md);
    }
    
    .plan-header {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
      padding-bottom: var(--spacing-sm);
      border-bottom: 1px solid rgba(0, 229, 255, 0.2);
    }
    
    .plan-info-item {
      text-align: center;
      font-family: 'Cairo', sans-serif;
    }
    
    .plan-info-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }
    
    .plan-info-value {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .day-section {
      margin-bottom: var(--spacing-md);
      padding-bottom: var(--spacing-md);
      border-bottom: 1px solid rgba(0, 229, 255, 0.15);
    }
    
    .day-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .day-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--spacing-sm);
      padding-bottom: var(--spacing-xs);
      border-bottom: 1px solid rgba(0, 229, 255, 0.2);
      font-family: 'Cairo', sans-serif;
    }
    
    .time-slot {
      margin-bottom: var(--spacing-sm);
    }
    
    .time-slot:last-child {
      margin-bottom: 0;
    }
    
    .time-slot-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--neon-cyan);
      margin-bottom: 6px;
      font-family: 'Cairo', sans-serif;
    }
    
    .time-slot-activities {
      margin-right: var(--spacing-sm);
    }
    
    .activity-item {
      padding: 8px 10px;
      background: rgba(0, 229, 255, 0.08);
      border-radius: 6px;
      margin-bottom: 6px;
      border-right: 2px solid rgba(0, 229, 255, 0.3);
      font-family: 'Cairo', sans-serif;
    }
    
    .activity-item:last-child {
      margin-bottom: 0;
    }
    
    .activity-name {
      font-size: 0.85rem;
      color: var(--text-primary);
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .activity-details {
      font-size: 0.75rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }
    
    .actions {
      display: flex;
      gap: var(--spacing-sm);
      justify-content: center;
      margin-top: var(--spacing-md);
      flex-wrap: wrap;
    }
    
    .actions .btn {
      font-family: 'Cairo', sans-serif;
      font-weight: 600;
      padding: 8px 16px;
      font-size: 0.9rem;
    }
    
    
    .message {
      text-align: center;
      margin-top: var(--spacing-sm);
      min-height: 20px;
      font-size: 0.85rem;
      font-family: 'Cairo', sans-serif;
    }
    
    @media (max-width: 768px) {
      .planner-container {
        padding: var(--spacing-sm);
      }
      
      .page-header h1 {
        font-size: 1.3rem;
      }
      
      .plan-header {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .day-activities {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body class="page-hidden">
  <nav class="arhgo-nav">
    <div class="arhgo-logo">ArhGo</div>
    <ul>
      <li><a data-nav href="index.html">ุงูุฑุฆูุณูุฉ</a></li>
      <li><a data-nav href="analytics.html">ุงูุชุญูููุงุช</a></li>
      <li><a data-nav href="budget-manager.html">ุฅุฏุงุฑุฉ ุงูููุฒุงููุฉ</a></li>
      <li><a data-nav href="price-comparison.html">ููุงุฑูุฉ ุงูุฃุณุนุงุฑ</a></li>
      <li><a data-nav href="smart-alerts.html">ุงูุชูุจููุงุช</a></li>
    </ul>
  </nav>

  <main class="planner-container">
    <div class="page-header">
      <h1>ูููุฏ ุฎุทุท ุฐูู</h1>
      <p>ุฎุทุฉ ุณูุฑ ูุญุณููุฉ ููุฎุตุตุฉ ูู</p>
    </div>

    <div class="plan-card">
      <div class="plan-header" id="tripInfo"></div>
      <div id="dailyPlans"></div>
      </div>
      
    <div class="actions" id="planActions" style="display: none;">
      <button id="savePlanBtn" class="btn btn-gradient">ุญูุธ ุงูุฎุทุฉ</button>
      <button id="sharePlanBtn" class="btn btn-ghost">ูุดุงุฑูุฉ ุงูุฎุทุฉ</button>
    </div>

    <div class="message" id="planMessage"></div>
  </main>

  <script>
    // ุงูุฏูู ุงูุนุฑุจูุฉ ูู ุขุณูุง ููุท
    const arabCountriesAsia = ['ุงูุณุนูุฏูุฉ', 'ุงูุฅูุงุฑุงุช', 'ุงููููุช', 'ูุทุฑ', 'ุงูุจุญุฑูู', 'ุนููุงู', 'ุนูุงู', 'ุงูููู', 'ุงูุนุฑุงู', 'ุณูุฑูุง', 'ุงูุฃุฑุฏู', 'ูุจูุงู', 'ููุณุทูู'];
    
    // ุฏุงูุฉ ููุญุตูู ุนูู ุจูุงูุงุช ุฏููุฉ ูุนููุฉ ูู MySQL
    let countryDataCache = {};
    
    async function getCountryData(countryName) {
      // ุชูุธูู ุงุณู ุงูุฏููุฉ
      countryName = countryName.trim();
      
      // ุงูุชุญูู ูู ุงููุงุด ุฃููุงู
      if (countryDataCache[countryName]) {
        return countryDataCache[countryName];
      }
      
      // ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ ูุจุงุดุฑุฉ (ุฃุณุฑุน)
      const defaultData = {
        'ุงูุณุนูุฏูุฉ': {
          cities: ['ุงูุฑูุงุถ', 'ุฌุฏุฉ', 'ุงูุฏูุงู', 'ุงููุฏููุฉ ุงููููุฑุฉ', 'ููุฉ ุงูููุฑูุฉ'],
          attractions: {
            cultural: ['ูุตุฑ ุงููุตูู', 'ูุชุญู ุงูููู ุนุจุฏุงูุนุฒูุฒ', 'ููุนุฉ ุงูุฑูุงุถ', 'ูุชุญู ูุตุฑ ุงููุฑุจุน'],
            nature: ['ูุงุฏู ุญูููุฉ', 'ููุชุฒู ุงูููู ุนุจุฏุงููู', 'ูุงุฏู ููุงุฑ', 'ุญุฏููุฉ ุงูููู ููุฏ'],
            adventure: ['ุฑุญูุฉ ุตุญุฑุงููุฉ', 'ุชุณูู ุงูุฌุจุงู', 'ุฑูุงุถุงุช ูุงุฆูุฉ'],
            food: ['ูุทุนู ุงููุฎูู', 'ูุทุนู ุงูุดุฑู', 'ูุทุนู ุงูุจูู']
          },
          budget: { low: 30, medium: 60, high: 120 },
          timeSlots: { morning: '08:00-12:00', afternoon: '14:00-17:00', evening: '19:00-22:00' },
          optimalRoute: true
        },
        'ุงูุฅูุงุฑุงุช': {
          cities: ['ุฏุจู', 'ุฃุจูุธุจู', 'ุงูุดุงุฑูุฉ', 'ุนุฌูุงู'],
          attractions: {
            cultural: ['ุจุฑุฌ ุฎูููุฉ', 'ูุชุญู ุงููููุฑ ุฃุจูุธุจู', 'ูุณุฌุฏ ุงูุดูุฎ ุฒุงูุฏ', 'ูุตุฑ ุงูุฅูุงุฑุงุช'],
            nature: ['ุดุงุทุฆ ุฌููุฑุง', 'ุญุฏููุฉ ุฏุจู', 'ูุงุฏู ุงููุบุงูุฑุงุช', 'ุงูุตุญุฑุงุก'],
            adventure: ['ููุฒ ุจุงููุธูุฉ', 'ุฑูุงุถุงุช ูุงุฆูุฉ', 'ุฑุญูุฉ ุตุญุฑุงููุฉ'],
            food: ['ูุทุนู At.mosphere', 'ูุทุนู Zuma', 'ูุทุนู Nobu']
          },
          budget: { low: 80, medium: 160, high: 320 },
          timeSlots: { morning: '09:00-12:00', afternoon: '15:00-18:00', evening: '20:00-23:00' },
          optimalRoute: true
        },
        'ุงููููุช': {
          cities: ['ุงููููุช', 'ุงูุณุงูููุฉ', 'ุงูุฌูุฑุงุก'],
          attractions: {
            cultural: ['ุฃุจุฑุงุฌ ุงููููุช', 'ูุชุญู ุงููููุช ุงููุทูู', 'ูุตุฑ ุงูุณูู', 'ุงููุชุญู ุงูุนููู'],
            nature: ['ุดุงุทุฆ ุงููููุช', 'ุญุฏููุฉ ุงูุดููุฏ', 'ุฌุฒูุฑุฉ ููููุง'],
            adventure: ['ุฑูุงุถุงุช ูุงุฆูุฉ', 'ุฑุญูุฉ ุจุญุฑูุฉ'],
            food: ['ูุทุนู ุงููููุช', 'ูุทุนู ุงูุดุงุทุฆ', 'ูุทุนู ุงูุณูู']
          },
          budget: { low: 40, medium: 80, high: 160 },
          timeSlots: { morning: '09:00-12:00', afternoon: '14:00-17:00', evening: '19:00-22:00' },
          optimalRoute: true
        },
        'ูุทุฑ': {
          cities: ['ุงูุฏูุญุฉ', 'ุงูุฑูุงู', 'ุงูุฎูุฑ'],
          attractions: {
            cultural: ['ูุชุญู ูุทุฑ ุงููุทูู', 'ูุชุญู ุงููู ุงูุฅุณูุงูู', 'ุณูู ูุงูู', 'ูุตุฑ ุงูุฏูุญุฉ'],
            nature: ['ุดุงุทุฆ ุงูุฎูุฑ', 'ุญุฏููุฉ ุฃุณุจุงูุฑ', 'ุงูุตุญุฑุงุก'],
            adventure: ['ุฑูุงุถุงุช ูุงุฆูุฉ', 'ุฑุญูุฉ ุตุญุฑุงููุฉ'],
            food: ['ูุทุนู ูุทุฑ', 'ูุทุนู ุงูุณูู', 'ูุทุนู ุงูุฎููุฌ']
          },
          budget: { low: 70, medium: 140, high: 280 },
          timeSlots: { morning: '09:00-12:00', afternoon: '14:00-17:00', evening: '19:00-22:00' },
          optimalRoute: true
        },
        'ุงูุจุญุฑูู': {
          cities: ['ุงูููุงูุฉ', 'ุงููุญุฑู', 'ุณุชุฑุฉ'],
          attractions: {
            cultural: ['ููุนุฉ ุงูุจุญุฑูู', 'ูุชุญู ุงูุจุญุฑูู ุงููุทูู', 'ูุณุฌุฏ ุงููุงุชุญ', 'ุจูุช ุงููุฑุขู'],
            nature: ['ุดุงุทุฆ ุงูุจุญุฑูู', 'ุญุฏููุฉ ุงูุนุฑูู', 'ุฌุฒูุฑุฉ ุฃููุงุฌ'],
            adventure: ['ุฑูุงุถุงุช ูุงุฆูุฉ', 'ุฑุญูุฉ ุจุญุฑูุฉ'],
            food: ['ูุทุนู ุงูุจุญุฑูู', 'ูุทุนู ุงูุฎููุฌ', 'ูุทุนู ุงูุณูู']
          },
          budget: { low: 35, medium: 70, high: 140 },
          timeSlots: { morning: '09:00-12:00', afternoon: '14:00-17:00', evening: '19:00-22:00' },
          optimalRoute: true
        },
        'ุนููุงู': {
          cities: ['ูุณูุท', 'ุตูุงูุฉ', 'ูุฒูู', 'ุตูุฑ'],
          attractions: {
            cultural: ['ูุตุฑ ุงูุณูุทุงู', 'ูุชุญู ุนูุงู ุงููุทูู', 'ููุนุฉ ูุฒูู', 'ุณูู ูุทุฑุญ'],
            nature: ['ูุงุฏู ุดุงุจ', 'ุฌุจู ุดูุณ', 'ุดุงุทุฆ ูุณูุท', 'ูุงุฏู ุจูู ุฎุงูุฏ'],
            adventure: ['ุชุณูู ุงูุฌุจุงู', 'ุฑุญูุฉ ุตุญุฑุงููุฉ', 'ุฑูุงุถุงุช ูุงุฆูุฉ'],
            food: ['ูุทุนู ุนูุงู', 'ูุทุนู ุงูุฌุจู', 'ูุทุนู ุงูุณุงุญู']
          },
          budget: { low: 35, medium: 70, high: 140 },
          timeSlots: { morning: '08:00-12:00', afternoon: '14:00-17:00', evening: '19:00-22:00' },
          optimalRoute: true
        },
        'ุนูุงู': {
          cities: ['ูุณูุท', 'ุตูุงูุฉ', 'ูุฒูู', 'ุตูุฑ'],
          attractions: {
            cultural: ['ูุตุฑ ุงูุณูุทุงู', 'ูุชุญู ุนูุงู ุงููุทูู', 'ููุนุฉ ูุฒูู', 'ุณูู ูุทุฑุญ'],
            nature: ['ูุงุฏู ุดุงุจ', 'ุฌุจู ุดูุณ', 'ุดุงุทุฆ ูุณูุท', 'ูุงุฏู ุจูู ุฎุงูุฏ'],
            adventure: ['ุชุณูู ุงูุฌุจุงู', 'ุฑุญูุฉ ุตุญุฑุงููุฉ', 'ุฑูุงุถุงุช ูุงุฆูุฉ'],
            food: ['ูุทุนู ุนูุงู', 'ูุทุนู ุงูุฌุจู', 'ูุทุนู ุงูุณุงุญู']
          },
          budget: { low: 35, medium: 70, high: 140 },
          timeSlots: { morning: '08:00-12:00', afternoon: '14:00-17:00', evening: '19:00-22:00' },
          optimalRoute: true
        },
        'ุงูููู': {
          cities: ['ุตูุนุงุก', 'ุนุฏู', 'ุชุนุฒ', 'ุญุถุฑููุช'],
          attractions: {
            cultural: ['ุตูุนุงุก ุงููุฏููุฉ', 'ูุตุฑ ุบูุฏุงู', 'ูุชุญู ุงูููู ุงููุทูู', 'ุณูู ุตูุนุงุก'],
            nature: ['ุฌุจู ุตุจุฑ', 'ูุงุฏู ุญุถุฑููุช', 'ุดุงุทุฆ ุนุฏู'],
            adventure: ['ุชุณูู ุงูุฌุจุงู', 'ุฑุญูุฉ ุตุญุฑุงููุฉ'],
            food: ['ูุทุนู ุงูููู', 'ูุทุนู ุงูุญุถุฑูู', 'ูุทุนู ุงูุณูู']
          },
          budget: { low: 20, medium: 40, high: 80 },
          timeSlots: { morning: '08:00-12:00', afternoon: '14:00-17:00', evening: '19:00-22:00' },
          optimalRoute: true
        },
        'ุงูุนุฑุงู': {
          cities: ['ุจุบุฏุงุฏ', 'ุงูุจุตุฑุฉ', 'ุงูููุตู', 'ุฃุฑุจูู', 'ูุฑุจูุงุก'],
          attractions: {
            cultural: ['ุงููุชุญู ุงูุนุฑุงูู', 'ุฃุทูุงู ุจุงุจู', 'ุงููุณุฌุฏ ุงูุฐูุจู', 'ูุตุฑ ุงูุนุงุดู'],
            nature: ['ููุฑ ุฏุฌูุฉ', 'ููุฑ ุงููุฑุงุช', 'ุฌุจุงู ูุฑุฏุณุชุงู'],
            adventure: ['ุฑุญูุฉ ููุฑูุฉ', 'ุชุณูู ุงูุฌุจุงู'],
            food: ['ูุทุนู ุจุบุฏุงุฏ', 'ูุทุนู ุงูุดุท', 'ูุทุนู ุงูุฑุงูุฏูู']
          },
          budget: { low: 25, medium: 50, high: 100 },
          timeSlots: { morning: '08:00-12:00', afternoon: '14:00-17:00', evening: '19:00-22:00' },
          optimalRoute: true
        },
        'ุณูุฑูุง': {
          cities: ['ุฏูุดู', 'ุญูุจ', 'ุงููุงุฐููุฉ', 'ุทุฑุทูุณ'],
          attractions: {
            cultural: ['ููุนุฉ ุญูุจ', 'ุชุฏูุฑ', 'ุงููุชุญู ุงููุทูู', 'ูุณุฌุฏ ุงูุฃููู'],
            nature: ['ุฌุจุงู ุงููุงุฐููุฉ', 'ูุงุฏู ุงูููุฑ', 'ุดุงุทุฆ ุงููุงุฐููุฉ'],
            adventure: ['ุชุณูู ุงูุฌุจุงู', 'ุฑุญูุฉ ุตุญุฑุงููุฉ'],
            food: ['ูุทุนู ุณูุฑูุง', 'ูุทุนู ุงูุดุงู', 'ูุทุนู ุงูุณุงุญู']
          },
          budget: { low: 20, medium: 40, high: 80 },
          timeSlots: { morning: '08:00-12:00', afternoon: '14:00-17:00', evening: '19:00-22:00' },
          optimalRoute: true
        },
        'ุงูุฃุฑุฏู': {
          cities: ['ุนูุงู', 'ุงูุจุชุฑุงุก', 'ุงูุนูุจุฉ', 'ุฅุฑุจุฏ'],
          attractions: {
            cultural: ['ุงูุจุชุฑุงุก', 'ููุนุฉ ุนูุงู', 'ูุชุญู ุงูุฃุฑุฏู', 'ุฌุจู ููุจู'],
            nature: ['ุงูุจุญุฑ ุงูููุช', 'ูุงุฏู ุฑู', 'ุฌุจุงู ุนุฌููู'],
            adventure: ['ุชุณูู ุงูุฌุจุงู', 'ุฑุญูุฉ ุตุญุฑุงููุฉ', 'ุฑูุงุถุงุช ูุงุฆูุฉ'],
            food: ['ูุทุนู ุงูุฃุฑุฏู', 'ูุทุนู ุงูุจุชุฑุงุก', 'ูุทุนู ุงูุจุญุฑ ุงูููุช']
          },
          budget: { low: 30, medium: 60, high: 120 },
          timeSlots: { morning: '08:00-12:00', afternoon: '14:00-17:00', evening: '19:00-22:00' },
          optimalRoute: true
        },
        'ูุจูุงู': {
          cities: ['ุจูุฑูุช', 'ุทุฑุงุจูุณ', 'ุตูุฏุง', 'ุฌุจูู'],
          attractions: {
            cultural: ['ูุชุญู ุจูุฑูุช', 'ููุนุฉ ุจุนูุจู', 'ูุชุญู ุฌุจูู', 'ูุตุฑ ุจูุช ุงูุฏูู'],
            nature: ['ุฌุจุงู ูุจูุงู', 'ุดุงุทุฆ ุจูุฑูุช', 'ูุงุฏู ูุงุฏูุดุง'],
            adventure: ['ุชุณูู ุงูุฌุจุงู', 'ุฑูุงุถุงุช ูุงุฆูุฉ'],
            food: ['ูุทุนู ูุจูุงู', 'ูุทุนู ุจูุฑูุช', 'ูุทุนู ุงูุณุงุญู']
          },
          budget: { low: 40, medium: 80, high: 160 },
          timeSlots: { morning: '09:00-12:00', afternoon: '14:00-17:00', evening: '19:00-22:00' },
          optimalRoute: true
        },
        'ููุณุทูู': {
          cities: ['ุงููุฏุณ', 'ุฑุงู ุงููู', 'ุจูุช ูุญู', 'ูุงุจูุณ'],
          attractions: {
            cultural: ['ุงููุณุฌุฏ ุงูุฃูุตู', 'ูููุณุฉ ุงูููุงูุฉ', 'ูุชุญู ููุณุทูู', 'ูุตุฑ ูุดุงู'],
            nature: ['ุงูุจุญุฑ ุงูููุช', 'ุฌุจู ุงูุฒูุชูู', 'ูุงุฏู ุงูุฃุฑุฏู'],
            adventure: ['ุชุณูู ุงูุฌุจุงู', 'ุฑุญูุฉ ุตุญุฑุงููุฉ'],
            food: ['ูุทุนู ููุณุทูู', 'ูุทุนู ุงููุฏุณ', 'ูุทุนู ุจูุช ูุญู']
          },
          budget: { low: 30, medium: 60, high: 120 },
          timeSlots: { morning: '08:00-12:00', afternoon: '14:00-17:00', evening: '19:00-22:00' },
          optimalRoute: true
        }
      };
      
      // ุงูุจุญุซ ูู ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ (ูุน ูุฑุงุนุงุฉ ุงููุณุงูุงุช)
      const cleanName = countryName.trim();
      console.log('ุงูุจุญุซ ุนู ุงูุฏููุฉ:', cleanName);
      console.log('ุงูุฏูู ุงููุชุงุญุฉ ูู ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ:', Object.keys(defaultData));
      
      if (defaultData[cleanName]) {
        countryDataCache[countryName] = defaultData[cleanName];
        console.log('ุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ุงูุฏููุฉ:', cleanName);
        return defaultData[cleanName];
      }
      
      // ูุญุงููุฉ ุงูุจุญุซ ุจุฏูู ููุฒุฉ
      const nameWithoutHamza = cleanName.replace('ุนููุงู', 'ุนูุงู').replace('ุนูุงู', 'ุนููุงู');
      if (defaultData[nameWithoutHamza]) {
        countryDataCache[countryName] = defaultData[nameWithoutHamza];
        console.log('ุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ุงูุฏููุฉ (ุจุฏูู ููุฒุฉ):', nameWithoutHamza);
        return defaultData[nameWithoutHamza];
      }
      
      // ุงูุจุญุซ ูู ุฌููุน ุงูููุงุชูุญ
      for (const key in defaultData) {
        const cleanKey = key.trim();
        if (cleanKey === cleanName || 
            cleanKey.replace('ุนููุงู', 'ุนูุงู') === cleanName.replace('ุนููุงู', 'ุนูุงู')) {
          countryDataCache[countryName] = defaultData[key];
          console.log('ุชู ุงูุนุซูุฑ ุนูู ุจูุงูุงุช ุงูุฏููุฉ (ูุทุงุจูุฉ):', key);
          return defaultData[key];
        }
      }
      
      // ุฅุฐุง ูุดู ูู ุดูุกุ ุฃุฑุฌุน null
      console.error('ุงูุฏููุฉ ุบูุฑ ููุฌูุฏุฉ ูู ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ:', countryName);
      console.error('ุงูุฏูู ุงููุชุงุญุฉ:', Object.keys(defaultData));
      return null;
    }
    
    // ูุงุนุฏุฉ ุจูุงูุงุช ุชูุตูููุฉ ููุฃูุงูู ุงูุณูุงุญูุฉ
    const placeDetailsDatabase = {
      'ุงูุณุนูุฏูุฉ': {
        'ุงูุฑูุงุถ': {
          cultural: {
            'ูุตุฑ ุงููุตูู': {
              description: 'ููุนุฉ ุชุงุฑูุฎูุฉ ุชุนูุฏ ูููุฑู ุงูุชุงุณุน ุนุดุฑุ ูุงูุช ูุณุฑุญุงู ููุนุฑูุฉ ุงุณุชุนุงุฏุฉ ุงูุฑูุงุถ. ุชุญุชูู ุนูู ูุชุญู ูุนุฑุถ ุชุงุฑูุฎ ุงูููููุฉ ูุชุฃุณูุณูุง.',
              activities: ['ุฒูุงุฑุฉ ุงููุชุญู', 'ูุดุงูุฏุฉ ุงูุจูุงุจุงุช ุงูุชุงุฑูุฎูุฉ', 'ุงูุชุตููุฑ', 'ุฌููุฉ ูู ุงูููุนุฉ'],
              address: 'ุญู ุงูุฏูุฑุฉุ ุงูุฑูุงุถ',
              bestTime: '09:00-12:00',
              duration: '2-3 ุณุงุนุงุช',
              tips: 'ุงุญุฑุต ุนูู ุงุฑุชุฏุงุก ููุงุจุณ ูุฑูุญุฉ ูุฎุฐ ูุงููุฑุง ูุนู'
            },
            'ูุชุญู ุงูููู ุนุจุฏุงูุนุฒูุฒ': {
              description: 'ูุชุญู ููุซู ุชุงุฑูุฎ ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ ููุฐ ุชุฃุณูุณูุง ูุญุชู ุงูููุช ุงูุญุงุถุฑุ ูุญุชูู ุนูู ูุนุฑูุถุงุช ุฃุซุฑูุฉ ูุชุงุฑูุฎูุฉ ูุงุฏุฑุฉ.',
              activities: ['ุฌููุฉ ูู ุงููุนุงุฑุถ', 'ูุดุงูุฏุฉ ุงููุซุงุฆู ุงูุชุงุฑูุฎูุฉ', 'ุงูุชุนุฑู ุนูู ุงูุชุฑุงุซ', 'ุงูุชุตููุฑ'],
              address: 'ุญู ุงููุทุงุฑุ ุงูุฑูุงุถ',
              bestTime: '10:00-13:00',
              duration: '2-3 ุณุงุนุงุช',
              tips: 'ุงุญุฌุฒ ุชุฐูุฑุชู ูุณุจูุงู ูุชุฌูุจ ุงูุงูุชุธุงุฑ'
            }
          },
          nature: {
            'ูุงุฏู ุญูููุฉ': {
              description: 'ูุงุฏู ุทุจูุนู ุฎูุงุจ ููุชุฏ ุนุจุฑ ุงูุฑูุงุถุ ูููุฑ ูุณุงุญุงุช ุฎุถุฑุงุก ูุงุณุนุฉ ูููุงุทู ููุชูุฒู ูุงูุงุณุชุฑุฎุงุก.',
              activities: ['ุงููุดู', 'ุงูุชูุฒู', 'ุงูุชุตููุฑ', 'ุงูุงุณุชุฑุฎุงุก', 'ูุดุงูุฏุฉ ุงูุทุจูุนุฉ'],
              address: 'ูุงุฏู ุญูููุฉุ ุงูุฑูุงุถ',
              bestTime: '07:00-10:00 ุฃู 16:00-19:00',
              duration: '2-3 ุณุงุนุงุช',
              tips: 'ุงุญูู ูุงุก ููุงูู ุดูุณุ ุฃูุถู ููุช ูู ุงูุตุจุงุญ ุงูุจุงูุฑ'
            }
          }
        }
      },
      'ุงูุฅูุงุฑุงุช': {
        'ุฏุจู': {
          cultural: {
            'ุจุฑุฌ ุฎูููุฉ': {
              description: 'ุฃุทูู ูุจูู ูู ุงูุนุงูู ุจุงุฑุชูุงุน 828 ูุชุฑุงูุ ูููุฑ ุฅุทูุงูุงุช ุจุงููุฑุงููุฉ ุฎูุงุจุฉ ุนูู ุฏุจู ูู ุงูุทุงุจู 124 ู148.',
              activities: ['ุตุนูุฏ ุงูุจุฑุฌ', 'ูุดุงูุฏุฉ ููุตุฉ ุงููุฑุงูุจุฉ', 'ุงูุชุตููุฑ ูู ุงูุฃุนูู', 'ุฒูุงุฑุฉ ูุงููุฑุฉ ุฏุจู'],
              address: '1 Sheikh Mohammed bin Rashid Blvd, Dubai',
              bestTime: '17:00-19:00 (ูุฑุคูุฉ ุงูุบุฑูุจ)',
              duration: '2-3 ุณุงุนุงุช',
              tips: 'ุงุญุฌุฒ ุชุฐูุฑุชู ูุณุจูุงูุ ุฃูุถู ููุช ุนูุฏ ุงูุบุฑูุจ'
            },
            'ูุชุญู ุงููููุฑ ุฃุจูุธุจู': {
              description: 'ูุชุญู ููู ุนุงููู ูุถู ูุฌููุนุฉ ุฑุงุฆุนุฉ ูู ุงูุฃุนูุงู ุงููููุฉ ูู ูุฎุชูู ุงูุญุถุงุฑุงุช ูุงูุซูุงูุงุช.',
              activities: ['ุฒูุงุฑุฉ ุงููุนุงุฑุถ', 'ูุดุงูุฏุฉ ุงูุฃุนูุงู ุงููููุฉ', 'ุฌููุฉ ูู ุงููุชุญู', 'ุงูุชุตููุฑ'],
              address: 'ุฌุฒูุฑุฉ ุงูุณุนุฏูุงุชุ ุฃุจูุธุจู',
              bestTime: '10:00-13:00',
              duration: '3-4 ุณุงุนุงุช',
              tips: 'ุงุญุฌุฒ ุชุฐูุฑุชู ูุณุจูุงูุ ุฎุฐ ููุชู ูู ุงูุชุฌูู'
            }
          },
          nature: {
            'ุดุงุทุฆ ุฌููุฑุง': {
              description: 'ุดุงุทุฆ ุฑุงุฆุน ูุน ููุงู ุฒุฑูุงุก ุตุงููุฉ ูุฑูุงู ุจูุถุงุก ูุงุนูุฉุ ูุซุงูู ููุงุณุชุฑุฎุงุก ูุงูุณุจุงุญุฉ.',
              activities: ['ุงูุณุจุงุญุฉ', 'ุงูุงุณุชุฑุฎุงุก', 'ุงูุชุตููุฑ', 'ูุดุงูุฏุฉ ุงูุบุฑูุจ', 'ุฑูุงุถุงุช ูุงุฆูุฉ'],
              address: 'ุดุงุทุฆ ุฌููุฑุงุ ุฏุจู',
              bestTime: '08:00-11:00 ุฃู 16:00-19:00',
              duration: '3-4 ุณุงุนุงุช',
              tips: 'ุงุญูู ูุงูู ุดูุณ ููุธูุฉุ ุชุฌูุจ ููุช ุงูุธููุฑุฉ'
            }
          }
        }
      }
    };
    
    function getPlaceDetails(placeName, city, country, type) {
      // ุงูุจุญุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ ุฃููุงู
      if (placeDetailsDatabase[country] && placeDetailsDatabase[country][city] && 
          placeDetailsDatabase[country][city][type] && 
          placeDetailsDatabase[country][city][type][placeName]) {
        return placeDetailsDatabase[country][city][type][placeName];
      }
      
      // ุจูุงูุงุช ุงูุชุฑุงุถูุฉ ุชูุตูููุฉ (ุจุฏูู ุงุณุชุฏุนุงุก API ูุชุณุฑูุน ุงูุนูููุฉ)
      const descriptions = {
        cultural: `${placeName} ูู ูุนูู ุซูุงูู ูุชุงุฑูุฎู ููู ูู ${city}ุ ${country}. ููุฏู ุชุฌุฑุจุฉ ุซูุงููุฉ ุบููุฉ ุชุชุนุฑู ูู ุฎูุงููุง ุนูู ุชุงุฑูุฎ ูุชุฑุงุซ ุงูููุทูุฉ.`,
        nature: `${placeName} ูู ููุงู ุทุจูุนู ุฎูุงุจ ูู ${city}ุ ${country}. ูููุฑ ุฅุทูุงูุงุช ุณุงุญุฑุฉ ููุฑุตุฉ ููุงุณุชุฑุฎุงุก ูุงูุงุณุชูุชุงุน ุจุฌูุงู ุงูุทุจูุนุฉ.`,
        adventure: `${placeName} ูููุฑ ุชุฌุฑุจุฉ ูุบุงูุฑุฉ ูุซูุฑุฉ ูู ${city}ุ ${country}. ููุงู ูุซุงูู ููุญุจู ุงูุฅุซุงุฑุฉ ูุงูุฃูุดุทุฉ ุงูุฑูุงุถูุฉ.`,
        food: `${placeName} ูู ูุทุนู ุฑุงูู ูู ${city}ุ ${country}. ููุฏู ุฃุทุจุงูุงู ูุฐูุฐุฉ ุชูุซู ุฃูุถู ูุง ุชูุฏูู ุงููุทุงุจุฎ ุงููุญููุฉ ูุงูุนุงูููุฉ.`
      };
      
      const activitiesList = {
        cultural: ['ุฒูุงุฑุฉ ุงูููุงู', 'ุฌููุฉ ุงุณุชูุดุงููุฉ', 'ุงูุชุตููุฑ', 'ุงูุชุนุฑู ุนูู ุงูุชุงุฑูุฎ', 'ูุดุงูุฏุฉ ุงููุนุฑูุถุงุช'],
        nature: ['ุงููุดู', 'ุงูุชูุฒู', 'ุงูุชุตููุฑ', 'ุงูุงุณุชุฑุฎุงุก', 'ูุดุงูุฏุฉ ุงูุทุจูุนุฉ'],
        adventure: ['ููุงุฑุณุฉ ุงูุฃูุดุทุฉ', 'ุงููุบุงูุฑุฉ', 'ุงูุชุตููุฑ', 'ุงูุงุณุชูุชุงุน ุจุงูุฅุซุงุฑุฉ'],
        food: ['ุชูุงูู ุงูุทุนุงู', 'ุชุฌุฑุจุฉ ุงูุฃุทุจุงู ุงููุญููุฉ', 'ุงูุงุณุชูุชุงุน ุจุงูุฃุฌูุงุก', 'ุงูุชุตููุฑ']
      };
      
      const defaultDetails = {
        description: descriptions[type] || `${placeName} ูู ููุงู ุณูุงุญู ุฑุงุฆุน ูู ${city}ุ ${country}. ูููุฑ ุชุฌุฑุจุฉ ูููุฒุฉ ููุฒูุงุฑ.`,
        activities: activitiesList[type] || ['ุฌููุฉ ุงุณุชูุดุงููุฉ', 'ุงูุชุตููุฑ', 'ุงูุงุณุชูุชุงุน ุจุงูููุงุธุฑ'],
        address: `${city}, ${country}`,
        bestTime: type === 'food' ? '19:00-22:00' : '09:00-17:00',
        duration: type === 'food' ? '2 ุณุงุนุงุช' : '2-3 ุณุงุนุงุช',
        tips: type === 'food' ? 'ุงุญุฌุฒ ุทุงููุฉ ูุณุจูุงู ุฎุงุตุฉ ูู ุนุทูุฉ ููุงูุฉ ุงูุฃุณุจูุน' : 'ุงุญุฑุต ุนูู ุงููุตูู ูุจูุฑุงู ูุชุฌูุจ ุงูุงุฒุฏุญุงู'
      };
      return defaultDetails;
    }

    function optimizeRoute(places, startPoint) {
      if (places.length <= 2) return places;
      const route = [startPoint];
      const remaining = places.filter(p => p !== startPoint);
      let current = startPoint;
      while (remaining.length > 0) {
        let nearest = remaining[0];
        let minDist = Math.random() * 10;
        for (const place of remaining) {
          const dist = Math.random() * 10;
          if (dist < minDist) {
            minDist = dist;
            nearest = place;
          }
        }
        route.push(nearest);
        remaining.splice(remaining.indexOf(nearest), 1);
        current = nearest;
      }
      return route;
    }

    async function generateSmartPlan(country, days, interests, budget) {
      // ุชูุธูู ุงุณู ุงูุฏููุฉ
      country = country.trim();
      console.log('ุงูุฏููุฉ ุงููุญุฏุฏุฉ:', country);
      console.log('ูุงุฆูุฉ ุงูุฏูู ุงูุนุฑุจูุฉ:', arabCountriesAsia);
      
      // ุงูุชุญูู ูู ุฃู ุงูุฏููุฉ ุนุฑุจูุฉ ูู ุขุณูุง (ูุน ูุฑุงุนุงุฉ ุงููุณุงูุงุช ูุงูููุฒุฉ)
      const cleanCountry = country.replace(/\s+/g, '');
      const isArabCountry = arabCountriesAsia.some(c => {
        const cleanC = c.replace(/\s+/g, '');
        return cleanC === cleanCountry || 
               cleanC.replace('ุนููุงู', 'ุนูุงู') === cleanCountry.replace('ุนููุงู', 'ุนูุงู');
      });
      
      console.log('ูู ุงูุฏููุฉ ุนุฑุจูุฉ ูู ุขุณูุงุ', isArabCountry);
      
      if (!isArabCountry) {
        console.error('ุงูุฏููุฉ ุบูุฑ ุตุญูุญุฉ:', country, 'ูุงุฆูุฉ ุงูุฏูู:', arabCountriesAsia);
        showMessage('ูุฑุฌู ุงุฎุชูุงุฑ ุฏููุฉ ุนุฑุจูุฉ ูู ูุงุฑุฉ ุขุณูุง ููุท', 'error');
        return [];
      }
      
      const countryData = await getCountryData(country);
      console.log('ุจูุงูุงุช ุงูุฏููุฉ ุงููุณุชุฑุฌุนุฉ:', countryData);
      
      if (!countryData) {
        console.error('ูุง ุชูุฌุฏ ุจูุงูุงุช ููุฏููุฉ:', country);
        showMessage('ูุง ุชูุฌุฏ ุจูุงูุงุช ูุชุงุญุฉ ููุฐู ุงูุฏููุฉ. ูุฑุฌู ุงูุชุฃูุฏ ูู ุฃู ุงูุฏููุฉ ุนุฑุจูุฉ ูู ุขุณูุง.', 'error');
        return [];
      }
      
      // ุงูุชุญูู ูู ูุฌูุฏ ุงูุจูุงูุงุช ุงููุทููุจุฉ
      if (!countryData.attractions || !countryData.attractions.budget) {
        console.error('ุจูุงูุงุช ุงูุฏููุฉ ุบูุฑ ููุชููุฉ:', countryData);
        showMessage('ุจูุงูุงุช ุงูุฏููุฉ ุบูุฑ ููุชููุฉ. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.', 'error');
        return [];
      }
      
      const budgetLevel = budget.toLowerCase().includes('ููุฎูุถ') || budget === 'low' ? 'low' : 
                         budget.toLowerCase().includes('ูุงุฎุฑ') || budget === 'high' ? 'high' : 'medium';
      const dailyBudget = countryData.attractions.budget[budgetLevel] || countryData.attractions.budget.medium || 60;
      
      const interestsList = interests ? interests.split(',').map(i => i.trim().toLowerCase()).filter(i => i) : [];
      const isCultural = interestsList.length === 0 || interestsList.some(i => ['ุซูุงูุฉ', 'ุชุงุฑูุฎ', 'ูุชุญู', 'cultural'].includes(i));
      const isNature = interestsList.length === 0 || interestsList.some(i => ['ุทุจูุนุฉ', 'ุฌุจุงู', 'ุจุญุฑ', 'nature'].includes(i));
      const isAdventure = interestsList.some(i => ['ูุบุงูุฑุฉ', 'ุฑูุงุถุฉ', 'adventure'].includes(i));
      const isFood = interestsList.length === 0 || interestsList.some(i => ['ุทุนุงู', 'food'].includes(i));
      
      const plan = [];
      
      // ุงูุชุญูู ูู ูุฌูุฏ ุงููุฏู
      if (!countryData.cities || countryData.cities.length === 0) {
        console.error('ูุง ุชูุฌุฏ ูุฏู ููุฏููุฉ:', countryData);
        showMessage('ูุง ุชูุฌุฏ ูุฏู ูุชุงุญุฉ ููุฐู ุงูุฏููุฉ.', 'error');
        return [];
      }
      
      console.log('ุนุฏุฏ ุงูุฃูุงู ุงููุทููุจุฉ:', days);
      console.log('ุงููุฏู ุงููุชุงุญุฉ:', countryData.cities);
      console.log('ุงูุฃูุงูู ุงูุซูุงููุฉ:', countryData.attractions.cultural);
      console.log('ุฃูุงูู ุงูุทุจูุนุฉ:', countryData.attractions.nature);
      console.log('ุงููุทุงุนู:', countryData.attractions.food);
      
      for (let day = 1; day <= days; day++) {
        const cityIndex = Math.min(day - 1, countryData.cities.length - 1);
        const city = countryData.cities[cityIndex];
        
        console.log(`ุชูููุฏ ุงูููู ${day} ูููุฏููุฉ ${city}`);
        
        const dayPlan = {
          day: day,
          city: city,
          morning: [],
          afternoon: [],
          evening: [],
          totalCost: 0,
          route: []
        };
        
        // ุงูุตุจุงุญ: ุฅุถุงูุฉ ูุดุงุท ุซูุงูู
        console.log(`ุงูููู ${day} - isCultural:`, isCultural, 'cultural places:', countryData.attractions.cultural);
        
        if (countryData.attractions.cultural && countryData.attractions.cultural.length > 0) {
          const culturalIndex = (day - 1) % countryData.attractions.cultural.length;
          const placeName = countryData.attractions.cultural[culturalIndex];
          const details = getPlaceDetails(placeName, city, country, 'cultural');
          
          dayPlan.morning.push({
            name: placeName,
            type: 'cultural',
            duration: details.duration || '2-3 ุณุงุนุงุช',
            cost: dailyBudget * 0.25,
            description: details.description,
            activities: details.activities,
            address: details.address,
            bestTime: details.bestTime,
            tips: details.tips
          });
          console.log(`ุชู ุฅุถุงูุฉ ูุดุงุท ุตุจุงุญู: ${placeName}`);
        }
        
        // ุจุนุฏ ุงูุธูุฑ: ุฅุถุงูุฉ ูุดุงุท ุทุจูุนุฉ
        console.log(`ุงูููู ${day} - isNature:`, isNature, 'nature places:', countryData.attractions.nature);
        
        if (countryData.attractions.nature && countryData.attractions.nature.length > 0) {
          const natureIndex = (day - 1) % countryData.attractions.nature.length;
          const placeName = countryData.attractions.nature[natureIndex];
          const details = getPlaceDetails(placeName, city, country, 'nature');
          
          dayPlan.afternoon.push({
            name: placeName,
            type: 'nature',
            duration: details.duration || '2-3 ุณุงุนุงุช',
            cost: dailyBudget * 0.25,
            description: details.description,
            activities: details.activities,
            address: details.address,
            bestTime: details.bestTime,
            tips: details.tips
          });
          console.log(`ุชู ุฅุถุงูุฉ ูุดุงุท ุจุนุฏ ุงูุธูุฑ: ${placeName}`);
        }
        
        // ุงููุณุงุก: ุฅุถุงูุฉ ูุทุนู
        console.log(`ุงูููู ${day} - food places:`, countryData.attractions.food);
        
        if (countryData.attractions.food && countryData.attractions.food.length > 0) {
          const foodIndex = (day - 1) % countryData.attractions.food.length;
          const restaurantName = countryData.attractions.food[foodIndex];
          const details = getPlaceDetails(restaurantName, city, country, 'food');
          
          dayPlan.evening.push({
            name: restaurantName,
            type: 'food',
            duration: details.duration || '2 ุณุงุนุงุช',
            cost: dailyBudget * 0.45,
            description: details.description || `ูุทุนู ุฑุงูู ูู ${city}`,
            activities: details.activities || ['ุชูุงูู ุงูุนุดุงุก', 'ุชุฌุฑุจุฉ ุงูุฃุทุจุงู ุงููุญููุฉ'],
            address: details.address,
            bestTime: details.bestTime,
            tips: details.tips
          });
          console.log(`ุชู ุฅุถุงูุฉ ูุทุนู: ${restaurantName}`);
        } else {
          // ุฅุฐุง ูู ููู ููุงู ูุทุงุนูุ ุฃุถู ูุทุนู ุงูุชุฑุงุถู
          dayPlan.evening.push({
            name: `ูุทุนู ูู ${city}`,
            type: 'food',
            duration: '2 ุณุงุนุงุช',
            cost: dailyBudget * 0.45,
            description: `ูุทุนู ุฑุงูู ูู ${city} ููุฏู ุฃุทุจุงูุงู ูุญููุฉ ูุนุงูููุฉ`,
            activities: ['ุชูุงูู ุงูุนุดุงุก', 'ุชุฌุฑุจุฉ ุงูุฃุทุจุงู ุงููุญููุฉ', 'ุงูุงุณุชูุชุงุน ุจุงูุฃุฌูุงุก'],
            address: `${city}, ${country}`,
            bestTime: '19:00-21:00',
            tips: 'ุงุญุฌุฒ ุทุงููุฉ ูุณุจูุงู ุฎุงุตุฉ ูู ุนุทูุฉ ููุงูุฉ ุงูุฃุณุจูุน'
          });
          console.log(`ุชู ุฅุถุงูุฉ ูุทุนู ุงูุชุฑุงุถู ูููุฏููุฉ ${city}`);
        }
        
        console.log(`ุงูููู ${day} - ุงูุฃูุดุทุฉ:`, {
          morning: dayPlan.morning.length,
          afternoon: dayPlan.afternoon.length,
          evening: dayPlan.evening.length
        });
        
        const allPlaces = [
          ...dayPlan.morning.map(a => a.name),
          ...dayPlan.afternoon.map(a => a.name),
          ...dayPlan.evening.map(a => a.name)
        ];
        dayPlan.route = optimizeRoute(allPlaces, allPlaces[0] || '');
        dayPlan.totalCost = dayPlan.morning.reduce((s, a) => s + a.cost, 0) +
                          dayPlan.afternoon.reduce((s, a) => s + a.cost, 0) +
                          dayPlan.evening.reduce((s, a) => s + a.cost, 0);
        
        plan.push(dayPlan);
      }
      
      console.log('ุงูุฎุทุฉ ุงูููุงุฆูุฉ:', plan);
      console.log('ุนุฏุฏ ุงูุฃูุงู ูู ุงูุฎุทุฉ:', plan.length);
      
      return plan;
    }

    async function displayPlan(plan, country, days, interests, budget) {
      const countryData = await getCountryData(country);
      
      const totalCost = plan.reduce((sum, day) => sum + day.totalCost, 0);
      
      const tripInfo = document.getElementById('tripInfo');
      tripInfo.innerHTML = `
        <div class="plan-info-item">
          <div class="plan-info-label">ุงููุฌูุฉ</div>
          <div class="plan-info-value">${country}</div>
          </div>
        <div class="plan-info-item">
          <div class="plan-info-label">ุงููุฏุฉ</div>
          <div class="plan-info-value">${days} ${days === 1 ? 'ููู' : 'ุฃูุงู'}</div>
          </div>
        <div class="plan-info-item">
          <div class="plan-info-label">ุงูููุฒุงููุฉ</div>
          <div class="plan-info-value">${budget}</div>
          </div>
        <div class="plan-info-item">
          <div class="plan-info-label">ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ</div>
          <div class="plan-info-value" style="color: var(--neon-cyan);">$${Math.round(totalCost)}</div>
        </div>
      `;
      
      const dailyPlans = document.getElementById('dailyPlans');
      dailyPlans.innerHTML = plan.map(day => `
        <div class="day-section">
          <div class="day-title">ุงูููู ${day.day} - ${day.city} ($${Math.round(day.totalCost)})</div>
          
          ${day.morning.length > 0 ? `
            <div class="time-slot">
              <div class="time-slot-title">ุงูุตุจุงุญ</div>
              <div class="time-slot-activities">
                ${day.morning.map(activity => `
                  <div class="activity-item">
                    <div class="activity-name">${activity.name}</div>
                    <div class="activity-details">
                      <div style="margin-bottom: 4px;">${activity.description || ''}</div>
                      <div style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 4px;">
                        ${activity.activities ? activity.activities.join(' โข ') : ''}
                      </div>
                      <div style="font-size: 0.7rem;">
                        ${activity.duration} โข $${Math.round(activity.cost)} โข ${activity.bestTime}
                        ${activity.address ? ' โข ' + activity.address : ''}
                      </div>
                      ${activity.tips ? `<div style="font-size: 0.7rem; color: var(--neon-cyan); margin-top: 4px;">๐ก ${activity.tips}</div>` : ''}
                    </div>
                        </div>
                            `).join('')}
                        </div>
            </div>
          ` : ''}
          
          ${day.afternoon.length > 0 ? `
            <div class="time-slot">
              <div class="time-slot-title">ุจุนุฏ ุงูุธูุฑ</div>
              <div class="time-slot-activities">
                ${day.afternoon.map(activity => `
                  <div class="activity-item">
                    <div class="activity-name">${activity.name}</div>
                    <div class="activity-details">
                      <div style="margin-bottom: 4px;">${activity.description || ''}</div>
                      <div style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 4px;">
                        ${activity.activities ? activity.activities.join(' โข ') : ''}
                      </div>
                      <div style="font-size: 0.7rem;">
                        ${activity.duration} โข $${Math.round(activity.cost)} โข ${activity.bestTime}
                        ${activity.address ? ' โข ' + activity.address : ''}
                      </div>
                      ${activity.tips ? `<div style="font-size: 0.7rem; color: var(--neon-cyan); margin-top: 4px;">๐ก ${activity.tips}</div>` : ''}
                    </div>
                        </div>
                            `).join('')}
                        </div>
            </div>
          ` : ''}
          
          ${day.evening.length > 0 ? `
            <div class="time-slot">
              <div class="time-slot-title">ุงููุณุงุก</div>
              <div class="time-slot-activities">
                ${day.evening.map(activity => `
                  <div class="activity-item">
                    <div class="activity-name">${activity.name}</div>
                    <div class="activity-details">
                      <div style="margin-bottom: 4px;">${activity.description || ''}</div>
                      <div style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 4px;">
                        ${activity.activities ? activity.activities.join(' โข ') : ''}
                      </div>
                      <div style="font-size: 0.7rem;">
                        ${activity.duration} โข $${Math.round(activity.cost)} โข ${activity.bestTime}
                        ${activity.address ? ' โข ' + activity.address : ''}
                      </div>
                      ${activity.tips ? `<div style="font-size: 0.7rem; color: var(--neon-cyan); margin-top: 4px;">๐ก ${activity.tips}</div>` : ''}
                    </div>
                        </div>
                            `).join('')}
                          </div>
                        </div>
                      ` : ''}
        </div>
      `).join('');
      
      document.getElementById('planActions').style.display = 'flex';
      
      const avgDailyCost = totalCost / days;
      
      window.currentPlanData = {
        country: country,
        days: days,
        budget: budget,
        interests: interests,
        plan: plan,
        totalCost: totalCost,
        avgDailyCost: avgDailyCost
      };
    }

    // ุชููุฆุฉ ุงูุตูุญุฉ
    (async function initPage() {
      // ูุฑุงุกุฉ ุงูุจูุงูุงุช ูู URL
      const params = new URLSearchParams(window.location.search);
      let country = params.get('country') || '';
      const days = parseInt(params.get('days'), 10) || 5;
      const interests = params.get('interests') || 'ุซูุงูุฉุ ุทุจูุนุฉ';
      const budget = params.get('budget') || 'ูุชูุณุทุฉ';
      
      console.log('ุงูุจูุงูุงุช ูู URL:', { country, days, interests, budget });
      console.log('URL ุงููุงูู:', window.location.href);
      
      // ุชูุธูู ุงุณู ุงูุฏููุฉ ูู ุงููุณุงูุงุช ุงูุฒุงุฆุฏุฉ
      if (country) {
        country = decodeURIComponent(country).trim();
        console.log('ุงูุฏููุฉ ุจุนุฏ ุงูุชูุธูู:', country);
      }
      
      // ุงูุชุญูู ูู ุฃู ุงูุฏููุฉ ูุญุฏุฏุฉ
      if (!country) {
        console.error('ุงูุฏููุฉ ุบูุฑ ูุญุฏุฏุฉ');
        showMessage('ูุฑุฌู ุชุญุฏูุฏ ุฏููุฉ ูู ุงูููุฑู', 'error');
        return;
      }

      // ุชูููุฏ ุงูุฎุทุฉ ููุฑุงู
      try {
        console.log('ุจุฏุก ุชูููุฏ ุงูุฎุทุฉ:', { country, days, interests, budget });
        const plan = await generateSmartPlan(country, days, interests, budget);
        console.log('ุงูุฎุทุฉ ุงููููุฏุฉ:', plan);
        console.log('ุทูู ุงูุฎุทุฉ:', plan ? plan.length : 0);
        
        if (plan && plan.length > 0) {
          console.log('ุนุฑุถ ุงูุฎุทุฉ...');
          await displayPlan(plan, country, days, interests, budget);
        } else {
          console.error('ูุดู ูู ุชูููุฏ ุงูุฎุทุฉ. ุงูุฎุทุฉ:', plan);
          showMessage('ูุดู ูู ุชูููุฏ ุงูุฎุทุฉ. ูุฑุฌู ุงูุชุฃูุฏ ูู ุฃู ุงูุฏููุฉ ุนุฑุจูุฉ ูู ุขุณูุง.', 'error');
        }
      } catch (error) {
        console.error('ุฎุทุฃ ูู ุชูููุฏ ุงูุฎุทุฉ:', error);
        console.error('ุชูุงุตูู ุงูุฎุทุฃ:', error.stack);
        showMessage('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชูููุฏ ุงูุฎุทุฉ: ' + (error.message || error), 'error');
      }
    })();

    document.getElementById('savePlanBtn').addEventListener('click', async function() {
      if (!window.currentPlanData) {
        showMessage('ูุง ุชูุฌุฏ ุฎุทุฉ ูุญูุธูุง', 'error');
        return;
      }

      const result = planManager.savePlan(window.currentPlanData);
      
      if (result.success) {
        showMessage(result.message, 'success');
        this.textContent = 'ุชู ุงูุญูุธ';
        this.disabled = true;
        setTimeout(() => {
          this.textContent = 'ุญูุธ ุงูุฎุทุฉ';
          this.disabled = false;
        }, 3000);
      } else {
        showMessage(result.message, 'error');
      }
    });

    document.getElementById('sharePlanBtn').addEventListener('click', async function() {
      if (!window.currentPlanData) {
        showMessage('ูุง ุชูุฌุฏ ุฎุทุฉ ูููุดุงุฑูุฉ', 'error');
        return;
      }

      const result = planManager.sharePlan(Date.now().toString());
      
      if (result.success) {
        const copyResult = await planManager.copyToClipboard(result.link);
        showMessage(copyResult.message, 'success');
      } else {
        showMessage(result.message, 'error');
      }
    });

    function showMessage(message, type) {
      const messageDiv = document.getElementById('planMessage');
      const colors = {
        success: 'var(--neon-cyan)',
        error: '#FF6B6B',
        info: 'var(--neon-cyan)'
      };
      
      messageDiv.innerHTML = `<div style="color: ${colors[type] || colors.info}; font-weight: 600;">${message}</div>`;
      
      setTimeout(() => {
          messageDiv.innerHTML = '';
      }, 5000);
    }
  </script>
</body>
</html>
